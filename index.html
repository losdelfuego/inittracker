
<!DOCTYPE html>
<!-- Init Tracker v4.2, 14Jan2019
Changelog:
- "goes first" checkbox
-->

<html><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1252">
  <title>RPG Initiative Tracker 4.2</title>
  <script src="scripts/jquery-latest.js"></script>
  <script src="scripts/jquery.sort.js"></script>
  <link rel="stylesheet" href="style.css#030817">
</head>

<body>

<div id="playerList" class="playerList">

<span class="add" id="add" >[+]</span>
<input type='checkbox' id='sortcheck' name='sortcheck'/>Ascending
				
	<ul class="player">
		<li><input id="goesfirst" class="goesfirst" type="checkbox"></li>
		<li><input id="name" class="name" value="Character Name" type="text" onclick="this.select()"></li>
		<li><input id="init" value="10" min="-100" max="100" type="number" onclick="this.select()"></li>
		<li><input id="perc" value="10" min="-100" max="100" type="number" onclick="this.select()"></li>
		<li><input id="ac" value="10" min="-100" max="100" type="number" onclick="this.select()"></li>
		<li><input id="dam" value="0" min="-100" max="100" type="number" onclick="this.select()"></li>
		<li><input id="sneak" value="0" min="-100" max="100" type="number" onclick="this.select()"></li>
		<li><input id="disguise" value="0" min="0" max="100" type="number" onclick="this.select()"></li>
		
		<li><input type="button" id="minus1" value="-1" /></li>
		<li><input type="button" id="minus5" value="-5" /></li>
		<li><input type="button" id="minus10" value="-10" /></li>
		<li><span class="delete">[-]</span></li>
	</ul>
	

	
</div>

<div id="inittable">
<table id="initiative" class="initiative">
	<thead><tr><th>Name</th><th class="sortvalue"></th><th class="table_init">Initiative</th><th class="table_perc">Perception</th><th class="table_ac">Armor</th><th class="table_dam">Damage</th><th class="table_sneak">Sneaking</th><th class="table_disguise">Disguise</th></tr></thead>
	<tbody></tbody>
</table>
</div>

<div id="dice">
	<form action="">
		<input type="radio" name="roll_type" id="1d100" value="1d100" checked="checked" />1d100<br>
		<input type="radio" name="roll_type" id="2d100" value="2d100" />2d100/2<br>
		<input type="radio" name="roll_type" id="3d6" value="3d6" />3d6<br>
		<input type="radio" name="roll_type" id="1d20" value="1d20" />1d20
	</form>

	<button onclick="roll_dice()">Roll</button>
	<p id="dice_result"></p>
</div>


<div id="description">
	<h1>RPG Initiative Tracker</h1>
	<h2>Version 4.2 / Jan 14 2019</h2>
	<h2><a href="InitTracker4.2.zip">Download</a></h2>
</div>



<script>
	$(document).ready(function () {
		// pre-populate the list with five additional players (the original plus five more for a total of six)
		for (i = 0; i < 6; i++) AddPlayerRow();
		
		UpdateResultsFn();

		$("#playerList #add").click(function () { AddPlayerRow(); UpdateResultsFn(); });
		
		// we use the .on() method here because the "[del]" control is created dynamically via the AddPlayerRow() method - $(".delete").click() won't work because the ".delete" buttons doesn't exist yet!
		$("#playerList").on("click", ".delete", function () {
		//	var cont = confirm('Delete Row?');
		//		if(cont) {
					if ($("#playerList ul").length <= 1) { alert("Can't delete last character."); return; }
					$(this).parents("ul").remove();
					UpdateResultsFn();
		//		}
			event.preventDefault();
		});

		$('#playerList').on("click", "#minus1", function() {
			var newInit = $(this).parents("ul").find('#init').val() - 1;
			$(this).parents("ul").find('#init').val(newInit);
			UpdateResultsFn();
		});

		$('#playerList').on("click", "#minus5", function() {
			var newInit = $(this).parents("ul").find('#init').val() - 5;
			$(this).parents("ul").find('#init').val(newInit);
			UpdateResultsFn();
		});

		$('#playerList').on("click", "#minus10", function() {
			var newInit = $(this).parents("ul").find('#init').val() - 10;
			$(this).parents("ul").find('#init').val(newInit);
			UpdateResultsFn();
		});
		
		$('#playerList').on('change', 'input', function() {	UpdateResultsFn(); });
		
		// some sort of weird table column sorting algo
		    var th = jQuery('th');
		    th.click(function(){
		    
			if ($('#sortcheck').prop('checked')) {
		        var inverse = false;
		    } else {
		        var inverse = true;
		    } 
			
		
		        var header = $(this),
		            index = header.index();
		        header
		            .closest('table')
		            .find('td')
		            .filter(function(){
		                return $(this).index() === index;
		            })
		            .sort(function(a, b){
		                
		                a = $(a).text();
		                b = $(b).text();
		                
		                return (
		                    isNaN(a) || isNaN(b) ?
		                        a > b : +a > +b
		                    ) ?
		                        inverse ? -1 : 1 :
		                        inverse ? 1 : -1;
		                    
		            }, function(){
		                return this.parentNode;
		            });
		    });
	});



	function AddPlayerRow() {
		// make a copy of the first UL in the player list, update its input controls' values and append it to the bottom of the list
		var newUL = $("#playerList ul:first").clone();
		newUL.find("#name").val("Character Name");
		newUL.find("#init").val("10");
		newUL.find("#perc").val("10");
		newUL.find("#ac").val("10");
		newUL.find("#dam").val("0");
		newUL.find("#sneak").val("0");
		newUL.find("#disguise").val("0");
		
		$("#playerList ul:last").after(newUL);
	}
	
	function UpdateResultsFn() {
		$("#initiative tbody").empty();
		$("#playerList ul").each(function () {
			
			// try to implement a "goes first" button
//			if ($(this).find("goesfirst").prop('checked')) {
//				var ordermodifier= $(this).find("#init").val();
//				ordermodifier=ordermodifier+100;
//				} else {
//				var ordermodifier= $(this).find("#init").val();
//			}
			ordermodifier=$(this).find("#init").val();
			initval=$(this).find("#init").val();
			percval=$(this).find("#perc").val();
			acval=$(this).find("#ac").val();
			damval=$(this).find("#dam").val();
			sneakval=$(this).find("#sneak").val();
			disguiseval=$(this).find("#disguise").val();
			
			if($(this).find("#goesfirst").prop('checked')) {
//				ordermodifier = $(this).find("#init").val() + 100;
				ordermodifier = parseInt(ordermodifier) + 100;
				}
			
			
			
			
			$("#initiative tbody").append("<tr><td>" + $(this).find("#name").val() + "</td><td class=\"sortvalue\">" + ordermodifier +	"</td><td class=\"table_init\">" + initval + "</td><td class=\"table_perc\">" + percval + "</td><td class=\"table_ac\">" + acval + "</td><td class=\"table_dam\">" + damval + "</td><td class=\"table_sneak\">" + sneakval + "</td><td class=\"table_disguise\">" + disguiseval + "</tr>");
			

			});


			
		// automatically sort by the "Initative" column
		$('#initiative th:eq(1)').click();
		
		// Count the number of text fields and set it up so that "enter" moves to the next one
		$(".name").keyup(function (event) {
			if (event.keyCode == 13) {
				textboxes = $("input.name");
				currentBoxNumber = textboxes.index(this);
				if (textboxes[currentBoxNumber + 1] != null) {
					nextBox = textboxes[currentBoxNumber + 1];
					nextBox.focus();
					nextBox.select();
				}
				event.preventDefault();
				return false;
			}
		});
		
	}
	
	function roll_dice() {
		if ( $("#1d100").is(':checked') == true ) { 
			var diceone = Math.floor(Math.random() * 100);
			var dice_result = diceone;
			}
		else if ( $("#2d100").is(':checked') == true ) {
			var diceone = Math.floor(Math.random() * 100);
			var dicetwo = Math.floor(Math.random() * 100);
			var dice_result = Math.floor(( +diceone + +dicetwo ) / 2);
			}
		else if ( $("#3d6").is(':checked') == true ) {
			var diceone = Math.floor(( Math.random() * 6) + 1);
			var dicetwo = Math.floor(( Math.random() * 6) + 1);
			var dicethree = Math.floor(( Math.random() * 6) +1);
			var dice_result = Math.floor( +diceone + +dicetwo + +dicethree);
			}
		else if ( $("#1d20").is(':checked') == true ) {
			var diceone = Math.floor(( Math.random() * 20) + 1);
			var dice_result = diceone;
		}
		
		$('#dice_result').html(('0'+dice_result).slice(-2));
		
		}
	
	
	
</script>
</body></html>